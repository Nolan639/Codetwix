const elements={conversionMode:document.getElementById("conversionMode"),customDropdown:document.getElementById("customDropdown"),dropdownTrigger:document.getElementById("dropdownTrigger"),dropdownMenu:document.getElementById("dropdownMenu"),selectedOption:document.querySelector(".selected-option"),themeSelector:document.getElementById("themeSelector"),fontSelector:document.getElementById("fontSelector"),detectedFormat:document.getElementById("detectedFormat"),confidenceBar:document.getElementById("confidenceBar"),confidenceText:document.getElementById("confidenceText"),overrideDetection:document.getElementById("overrideDetection"),caesarControls:document.getElementById("caesarControls"),caesarShift:document.getElementById("caesarShift"),caesarDirection:document.getElementById("caesarDirection"),showBruteForce:document.getElementById("showBruteForce"),vigenereControls:document.getElementById("vigenereControls"),vigenereKey:document.getElementById("vigenereKey"),vigenereDirection:document.getElementById("vigenereDirection"),affineControls:document.getElementById("affineControls"),affineA:document.getElementById("affineA"),affineB:document.getElementById("affineB"),affineDirection:document.getElementById("affineDirection"),playfairControls:document.getElementById("playfairControls"),playfairKey:document.getElementById("playfairKey"),playfairDirection:document.getElementById("playfairDirection"),showMatrix:document.getElementById("showMatrix"),xorControls:document.getElementById("xorControls"),xorKey:document.getElementById("xorKey"),xorDirection:document.getElementById("xorDirection"),bruteForcePanel:document.getElementById("bruteForcePanel"),bruteForceResults:document.getElementById("bruteForceResults"),closeBruteForce:document.getElementById("closeBruteForce"),matrixPanel:document.getElementById("matrixPanel"),matrixDisplay:document.getElementById("matrixDisplay"),closeMatrix:document.getElementById("closeMatrix"),inputText:document.getElementById("inputText"),outputText:document.getElementById("outputText"),inputStats:document.getElementById("inputStats"),letterPercent:document.getElementById("letterPercent"),numberPercent:document.getElementById("numberPercent"),symbolPercent:document.getElementById("symbolPercent"),asciiBreakdown:document.getElementById("asciiBreakdown"),copyBtn:document.getElementById("copyBtn"),shareBtn:document.getElementById("shareBtn"),qrBtn:document.getElementById("qrBtn"),downloadBtn:document.getElementById("downloadBtn"),historyContainer:document.getElementById("historyContainer"),clearHistoryBtn:document.getElementById("clearHistoryBtn"),qrModal:document.getElementById("qrModal"),qrCanvas:document.getElementById("qrCanvas"),downloadQr:document.getElementById("downloadQr"),closeQrModal:document.getElementById("closeQrModal"),shareModal:document.getElementById("shareModal"),shareLink:document.getElementById("shareLink"),copyShareLink:document.getElementById("copyShareLink"),closeShareModal:document.getElementById("closeShareModal"),toast:document.getElementById("toast"),toastMessage:document.getElementById("toastMessage")},state={currentTheme:localStorage.getItem("codetwix-theme")||"dark",currentFont:localStorage.getItem("codetwix-font")||"monospace",history:JSON.parse(localStorage.getItem("codetwix-history")||"[]"),favorites:new Set(JSON.parse(localStorage.getItem("codetwix-favorites")||"[]")),autoDetectionEnabled:!0,debounceTimer:null},converters={textToBinary:e=>e.split("").map(e=>e.charCodeAt(0).toString(2).padStart(8,"0")).join(" "),binaryToText(e){let t=e.replace(/[^01\s]/g,"").trim();if(!t)throw Error("Invalid binary input");let r=t.includes(" ")?t.split(/\s+/):t.match(/.{1,8}/g)||[];return r.map(e=>String.fromCharCode(parseInt(e,2))).join("")},textToMorse(e){let t={A:".-",B:"-...",C:"-.-.",D:"-..",E:".",F:"..-.",G:"--.",H:"....",I:"..",J:".---",K:"-.-",L:".-..",M:"--",N:"-.",O:"---",P:".--.",Q:"--.-",R:".-.",S:"...",T:"-",U:"..-",V:"...-",W:".--",X:"-..-",Y:"-.--",Z:"--..",0:"-----",1:".----",2:"..---",3:"...--",4:"....-",5:".....",6:"-....",7:"--...",8:"---..",9:"----."," ":"/",".":".-.-.-",",":"--..--","?":"..--..","'":".----.","!":"-.-.--","/":"-..-.","(":"-.--.",")":"-.--.-","&":".-...",":":"---...",";":"-.-.-.","=":"-...-","+":".-.-.","-":"-....-",_:"..--.-",'"':".-..-.",$:"...-..-","@":".--.-."};return e.toUpperCase().split("").map(e=>t[e]||e).join(" ")},morseToText(e){let t={".-":"A","-...":"B","-.-.":"C","-..":"D",".":"E","..-.":"F","--.":"G","....":"H","..":"I",".---":"J","-.-":"K",".-..":"L","--":"M","-.":"N","---":"O",".--.":"P","--.-":"Q",".-.":"R","...":"S","-":"T","..-":"U","...-":"V",".--":"W","-..-":"X","-.--":"Y","--..":"Z","/":" ","-----":"0",".----":"1","..---":"2","...--":"3","....-":"4",".....":"5","-....":"6","--...":"7","---..":"8","----.":"9"};return e.split(" ").map(e=>t[e]||e).join("")},textToHex:e=>e.split("").map(e=>e.charCodeAt(0).toString(16).padStart(2,"0")).join(" ").toUpperCase(),hexToText(e){let t=e.replace(/[^0-9A-Fa-f\s]/g,"");if(!t)throw Error("Invalid hex input");let r=t.includes(" ")?t.split(/\s+/):t.match(/.{1,2}/g)||[];return r.map(e=>String.fromCharCode(parseInt(e,16))).join("")},textToBase64:e=>btoa(unescape(encodeURIComponent(e))),base64ToText(e){try{return decodeURIComponent(escape(atob(e)))}catch(t){throw Error("Invalid Base64 input")}},textToBase32(e){let t="";for(let r=0;r<e.length;r++)t+=e.charCodeAt(r).toString(2).padStart(8,"0");let n="";for(let o=0;o<t.length;o+=5){let a=t.substr(o,5).padEnd(5,"0");n+="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"[parseInt(a,2)]}return n},base32ToText(e){let t="";for(let r=0;r<e.length;r++){let n="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".indexOf(e[r].toUpperCase());-1!==n&&(t+=n.toString(2).padStart(5,"0"))}let o="";for(let a=0;a<t.length;a+=8){let s=t.substr(a,8);8===s.length&&(o+=String.fromCharCode(parseInt(s,2)))}return o},textToBase58(e){if(!e)return"";let t=new TextEncoder().encode(e),r=BigInt(0);for(let n of t)r=r*BigInt(256)+BigInt(n);let o="";for(;r>0;)o="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"[Number(r%BigInt(58))]+o,r/=BigInt(58);return o||"1"},base58ToText(e){if(!e)return"";let t=BigInt(0);for(let r of e){let n="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz".indexOf(r);if(-1===n)throw Error("Invalid Base58 character");t=t*BigInt(58)+BigInt(n)}let o=[];for(;t>0;)o.unshift(Number(t%BigInt(256))),t/=BigInt(256);return new TextDecoder().decode(new Uint8Array(o))},urlEncode:e=>encodeURIComponent(e),urlDecode(e){try{return decodeURIComponent(e)}catch(t){throw Error("Invalid URL encoded text")}},caesarCipher(e,t,r=!0){let n=(t*(r?1:-1)+26)%26;return e.split("").map(e=>{if(e.match(/[a-z]/i)){let t=e===e.toUpperCase(),r=e.toLowerCase().charCodeAt(0),o=String.fromCharCode((r-97+n)%26+97);return t?o.toUpperCase():o}return e}).join("")},rot13:e=>converters.caesarCipher(e,13,!0),vigenereCipher(e,t,r=!0){if(!t)throw Error("Keyword required for Vigen\xe8re cipher");let n=t.toUpperCase(),o=0;return e.split("").map(e=>{if(e.match(/[a-z]/i)){let t=e===e.toUpperCase(),a=e.toUpperCase().charCodeAt(0)-65,s=n.charCodeAt(o%n.length)-65;o++;let i=String.fromCharCode((r?(a+s)%26:(a-s+26)%26)+65);return t?i:i.toLowerCase()}return e}).join("")},affineCipher(e,t,r,n=!0){let o=(e,t)=>{for(let r=1;r<t;r++)if(e*r%t==1)return r;throw Error("Invalid key A (no modular inverse)")};return e.split("").map(e=>{if(e.match(/[a-z]/i)){let a=e===e.toUpperCase(),s=e.toUpperCase().charCodeAt(0)-65,i;if(n)i=(t*s+r)%26;else{let l=o(t,26);i=l*(s-r+26)%26}let c=String.fromCharCode(i+65);return a?c:c.toLowerCase()}return e}).join("")},playfairCipher(e,t,r=!0){if(!t)throw Error("Keyword required for Playfair cipher");let n=(e=>{let t="ABCDEFGHIKLMNOPQRSTUVWXYZ",r=new Set,n=[];for(let o of e.toUpperCase())"J"===o&&(o="I"),t.includes(o)&&!r.has(o)&&(n.push(o),r.add(o));for(let a of t)r.has(a)||n.push(a);let s=[];for(let i=0;i<5;i++)s.push(n.slice(5*i,(i+1)*5));return s})(t),o=e=>{for(let t=0;t<5;t++)for(let r=0;r<5;r++)if(n[t][r]===e)return[t,r];return null},a=e.toUpperCase().replace(/[^A-Z]/g,"").replace(/J/g,"I"),s=[];for(let i=0;i<a.length;i+=2){let l=a[i],c=a[i+1]||"X";l===c&&(c="X",i--),s.push([l,c])}let d="";for(let[m,u]of s){let[p,y]=o(m),[f,h]=o(u);p===f?r?d+=n[p][(y+1)%5]+n[f][(h+1)%5]:d+=n[p][(y+4)%5]+n[f][(h+4)%5]:y===h?r?d+=n[(p+1)%5][y]+n[(f+1)%5][h]:d+=n[(p+4)%5][y]+n[(f+4)%5][h]:d+=n[p][h]+n[f][y]}return d},xorEncryption(e,t){if(!t)throw Error("Key required for XOR encryption");return e.split("").map((e,r)=>{let n=e.charCodeAt(0),o=t.charCodeAt(r%t.length);return String.fromCharCode(n^o)}).join("")}},autoDetector={detectFormat(e){if(!e.trim())return{format:"None",confidence:0};let t=[{format:"Binary",confidence:autoDetector.isBinary(e)},{format:"Base64",confidence:autoDetector.isBase64(e)},{format:"Hexadecimal",confidence:autoDetector.isHex(e)},{format:"Morse Code",confidence:autoDetector.isMorse(e)},{format:"URL Encoded",confidence:autoDetector.isUrlEncoded(e)},{format:"ROT13",confidence:autoDetector.isRot13(e)}],r=t.reduce((e,t)=>e.confidence>t.confidence?e:t);return r.confidence>.5?r:{format:"Plain Text",confidence:.8}},isBinary(e){let t=e.replace(/\s/g,"");return/^[01]+$/.test(t)?t.length%8==0?.9:.7:0},isBase64(e){try{let t=e.replace(/\s/g,"");if(!/^[A-Za-z0-9+/]*={0,2}$/.test(t))return 0;return atob(t),.9}catch{return 0}},isHex(e){let t=e.replace(/\s/g,"");return/^[0-9A-Fa-f]+$/.test(t)?t.length%2==0?.9:.7:0},isMorse:e=>/^[.\-\s\/]+$/.test(e)?.8:0,isUrlEncoded:e=>/%[0-9A-Fa-f]{2}/.test(e)?.8:0,isRot13(e){let t=converters.rot13(e),r=["the","and","you","that","was","for","are","with","his","they"].filter(e=>t.toLowerCase().includes(e)).length;return r>0?Math.min(.2*r,.8):0}},textAnalyzer={getStats(e){let t=e.length,r=e.trim()?e.trim().split(/\s+/).length:0,n=0,o=0,a=0;for(let s of e)/[a-zA-Z]/.test(s)?n++:/[0-9]/.test(s)?o++:a++;let i=n+o+a||1;return{chars:t,words:r,bits:8*t,letterPercent:Math.round(n/i*100),numberPercent:Math.round(o/i*100),symbolPercent:Math.round(a/i*100)}},getAsciiBreakdown(e){let t={};for(let r of e){let n=r.charCodeAt(0),o=n.toString(16).toUpperCase().padStart(2,"0"),a=n.toString(2).padStart(8,"0");t[r]={ascii:n,hex:o,binary:a}}return t}},themeManager={setTheme(e){document.body.setAttribute("data-theme",e),state.currentTheme=e,localStorage.setItem("codetwix-theme",e),elements.themeSelector.value=e},setFont(e){document.body.setAttribute("data-font",e),state.currentFont=e,localStorage.setItem("codetwix-font",e),elements.fontSelector.value=e}},historyManager={add(e,t,r){let n={id:Date.now(),mode:e,input:t.substring(0,200),output:r.substring(0,200),timestamp:new Date().toLocaleString(),favorite:!1};state.history.unshift(n),state.history.length>10&&(state.history=state.history.slice(0,10)),localStorage.setItem("codetwix-history",JSON.stringify(state.history)),historyManager.render()},render(){if(0===state.history.length){elements.historyContainer.innerHTML='<p class="no-history">No recent conversions</p>';return}let e=state.history.map(e=>`
            <div class="history-item" data-id="${e.id}">
                <div class="history-item-header">
                    <div class="history-mode">${getModeDisplayName(e.mode)}</div>
                    <div class="history-actions">
                        <button class="history-btn star-btn ${state.favorites.has(e.id)?"starred":""}" 
                                onclick="historyManager.toggleFavorite(${e.id})" title="Star">‚≠ê</button>
                        <button class="history-btn copy-btn" 
                                onclick="historyManager.copyItem(${e.id})" title="Copy">üìã</button>
                    </div>
                </div>
                <div class="history-preview" onclick="historyManager.loadItem(${e.id})">${escapeHtml(e.input)}</div>
                <div class="history-timestamp">${e.timestamp}</div>
            </div>
        `).join("");elements.historyContainer.innerHTML=e},loadItem(e){let t=state.history.find(t=>t.id===e);if(t){elements.inputText.value=t.input,elements.outputText.value=t.output;let r=elements.dropdownMenu.querySelector(`[data-value="${t.mode}"]`);r&&selectOption(r)}},copyItem(e){let t=state.history.find(t=>t.id===e);t&&copyToClipboard(t.output)},toggleFavorite(e){state.favorites.has(e)?state.favorites.delete(e):state.favorites.add(e),localStorage.setItem("codetwix-favorites",JSON.stringify([...state.favorites])),historyManager.render()},clear(){let e=elements.historyContainer.querySelectorAll(".history-item");e.forEach((e,t)=>{setTimeout(()=>{e.style.animation="fadeOutRight 0.4s ease-out forwards"},100*t)}),setTimeout(()=>{state.history=[],state.favorites.clear(),localStorage.removeItem("codetwix-history"),localStorage.removeItem("codetwix-favorites"),historyManager.render(),showToast("History cleared! \uD83E\uDDF9","success")},100*e.length+400)}};function escapeHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}function getModeDisplayName(e){return({textToBinary:"Text ‚Üí Binary",binaryToText:"Binary ‚Üí Text",textToMorse:"Text ‚Üí Morse",morseToText:"Morse ‚Üí Text",textToBase64:"Text ‚Üí Base64",base64ToText:"Base64 ‚Üí Text",textToBase32:"Text ‚Üí Base32",base32ToText:"Base32 ‚Üí Text",textToBase58:"Text ‚Üí Base58",base58ToText:"Base58 ‚Üí Text",textToHex:"Text ‚Üí Hex",hexToText:"Hex ‚Üí Text",urlEncode:"URL Encode",urlDecode:"URL Decode",caesarCipher:"Caesar Cipher",rot13:"ROT13",vigenereCipher:"Vigen\xe8re Cipher",affineCipher:"Affine Cipher",playfairCipher:"Playfair Cipher",xorEncryption:"XOR Encryption"})[e]||e}function showToast(e,t="success"){elements.toastMessage.textContent=e,elements.toast.className=`toast ${t} show`,setTimeout(()=>elements.toast.classList.remove("show"),3e3)}function performConversion(){let e=elements.inputText.value,t=elements.conversionMode.value;if(!e.trim()){elements.outputText.value="",updateStats("");return}try{let r="";switch(t){case"caesarCipher":let n=parseInt(elements.caesarShift.value)||0,o="encrypt"===elements.caesarDirection.dataset.direction;r=converters.caesarCipher(e,n,o);break;case"vigenereCipher":let a=elements.vigenereKey.value,s="encrypt"===elements.vigenereDirection.dataset.direction;r=converters.vigenereCipher(e,a,s);break;case"affineCipher":let i=parseInt(elements.affineA.value)||5,l=parseInt(elements.affineB.value)||8,c="encrypt"===elements.affineDirection.dataset.direction;r=converters.affineCipher(e,i,l,c);break;case"playfairCipher":let d=elements.playfairKey.value,m="encrypt"===elements.playfairDirection.dataset.direction;r=converters.playfairCipher(e,d,m);break;case"xorEncryption":let u=elements.xorKey.value;r=converters.xorEncryption(e,u);break;default:if(converters[t])r=converters[t](e);else throw Error("Unknown conversion mode")}elements.outputText.value=r,historyManager.add(t,e,r),updateStats(e),updateAsciiBreakdown(t,e)}catch(p){showToast(`Error: ${p.message}`,"error"),elements.outputText.value=""}}function updateStats(e){let t=textAnalyzer.getStats(e),r=elements.inputStats.querySelectorAll(".stat");r.length>=3&&(r[0].textContent=`${t.chars} chars`,r[1].textContent=`${t.words} words`,r[2].textContent=`${t.bits} bits`),elements.letterPercent.textContent=`${t.letterPercent}%`,elements.numberPercent.textContent=`${t.numberPercent}%`,elements.symbolPercent.textContent=`${t.symbolPercent}%`}function updateAsciiBreakdown(e,t){if("textToBinary"===e||"textToHex"===e){let r=textAnalyzer.getAsciiBreakdown(t),n=Object.entries(r).map(([e,t])=>`<div>${e}: ASCII ${t.ascii}, Hex ${t.hex}, Binary ${t.binary}</div>`).join("");elements.asciiBreakdown.innerHTML=n,elements.asciiBreakdown.style.display="block"}else elements.asciiBreakdown.style.display="none"}function updateAutoDetection(){if(!state.autoDetectionEnabled)return;let e=elements.inputText.value,t=autoDetector.detectFormat(e);elements.detectedFormat.textContent=t.format,elements.confidenceBar.style.setProperty("--confidence",`${100*t.confidence}%`),elements.confidenceText.textContent=`${Math.round(100*t.confidence)}%`,t.confidence>.7&&"Plain Text"!==t.format?(elements.overrideDetection.style.display="inline-block",elements.overrideDetection.onclick=()=>autoSwitchMode(t.format)):elements.overrideDetection.style.display="none"}function autoSwitchMode(e){let t={Binary:"binaryToText",Base64:"base64ToText",Hexadecimal:"hexToText","Morse Code":"morseToText","URL Encoded":"urlDecode",ROT13:"rot13"}[e];if(t){let r=elements.dropdownMenu.querySelector(`[data-value="${t}"]`);r&&(selectOption(r),performConversion())}}function initializeCustomDropdown(){if(!elements.dropdownTrigger||!elements.dropdownMenu)return;let e=!1;function t(){e=!1,elements.dropdownTrigger.classList.remove("active"),elements.dropdownMenu.classList.remove("show")}elements.dropdownTrigger.addEventListener("click",r=>{r.stopPropagation(),e?t():(e=!0,elements.dropdownTrigger.classList.add("active"),elements.dropdownMenu.classList.add("show"))}),elements.dropdownMenu.addEventListener("click",e=>{e.target.classList.contains("dropdown-option")&&selectOption(e.target)}),document.addEventListener("click",r=>{!elements.customDropdown.contains(r.target)&&e&&t()}),window.selectOption=function(e){let r=e.dataset.value,n=e.textContent;elements.selectedOption.textContent=n,elements.conversionMode.value=r,elements.dropdownMenu.querySelectorAll(".dropdown-option").forEach(e=>e.classList.remove("selected")),e.classList.add("selected"),t(),toggleCipherControls(),performConversion()};let r=elements.dropdownMenu.querySelector(".dropdown-option");r&&r.classList.add("selected")}function toggleCipherControls(){let e=elements.conversionMode.value;[elements.caesarControls,elements.vigenereControls,elements.affineControls,elements.playfairControls,elements.xorControls].forEach(e=>{e&&(e.style.display="none")});let t={caesarCipher:elements.caesarControls,vigenereCipher:elements.vigenereControls,affineCipher:elements.affineControls,playfairCipher:elements.playfairControls,xorEncryption:elements.xorControls};t[e]&&(t[e].style.display="flex")}function generateBruteForce(){let e=elements.inputText.value;if(!e)return;let t="";for(let r=1;r<=25;r++){let n=converters.caesarCipher(e,r,!1),o=n.replace(/'/g,"\\'").replace(/"/g,'\\"');t+=`
            <div class="brute-force-item" onclick="selectBruteForceResult('${o}')">
                <span>Shift ${r}:</span>
                <span>${escapeHtml(n.substring(0,50))}${n.length>50?"...":""}</span>
            </div>
        `}elements.bruteForceResults.innerHTML=t,elements.bruteForcePanel.style.display="block"}function selectBruteForceResult(e){elements.outputText.value=e.replace(/\\'/g,"'").replace(/\\"/g,'"'),elements.bruteForcePanel.style.display="none"}function generatePlayfairMatrix(){let e=elements.playfairKey.value;if(!e){showToast("Please enter a keyword first","error");return}let t="ABCDEFGHIKLMNOPQRSTUVWXYZ",r=new Set,n=[];for(let o of e.toUpperCase())"J"===o&&(o="I"),t.includes(o)&&!r.has(o)&&(n.push(o),r.add(o));for(let a of t)r.has(a)||n.push(a);let s='<div class="playfair-matrix">';for(let i=0;i<25;i++)s+=`<div class="matrix-cell">${n[i]}</div>`;s+="</div>",elements.matrixDisplay.innerHTML=s,elements.matrixPanel.style.display="block"}async function copyToClipboard(e=null){let t=e||elements.outputText.value;if(!t){showToast("Nothing to copy","error");return}try{await navigator.clipboard.writeText(t),showToast("Copied to clipboard! \uD83D\uDCCB","success")}catch(r){showToast("Copy failed","error")}}function downloadFile(e){let t=elements.outputText.value;if(!t){showToast("Nothing to download","error");return}let r=getModeDisplayName(elements.conversionMode.value),n,o,a;switch(e){case"txt":n=t,o="text/plain",a="txt";break;case"csv":n=`"Input","Output","Mode","Timestamp"
"${elements.inputText.value}","${t}","${r}","${new Date().toLocaleString()}"`,o="text/csv",a="csv";break;case"json":n=JSON.stringify({input:elements.inputText.value,output:t,mode:r,timestamp:new Date().toISOString()},null,2),o="application/json",a="json"}let s=new Blob([n],{type:o}),i=URL.createObjectURL(s),l=document.createElement("a");l.href=i,l.download=`codetwix-${r.toLowerCase().replace(/[^a-z0-9]/g,"-")}-${Date.now()}.${a}`,l.click(),URL.revokeObjectURL(i),showToast(`Downloaded as ${a.toUpperCase()}! üì•`,"success")}function generateShareLink(){let e={input:elements.inputText.value,mode:elements.conversionMode.value,timestamp:Date.now()},t=btoa(JSON.stringify(e)),r=`${window.location.origin}${window.location.pathname}?share=${t}`;elements.shareLink.value=r,elements.shareModal.style.display="flex"}function generateQRCode(){let e=elements.outputText.value;if(!e){showToast("Nothing to encode in QR","error");return}if(!elements.qrCanvas){showToast("QR Canvas not available","error");return}let t=elements.qrCanvas,r=t.getContext("2d");if(!r){showToast("Canvas context not available","error");return}t.width=200,t.height=200,r.fillStyle="#000",r.fillRect(0,0,200,200),r.fillStyle="#fff",r.font="12px monospace",r.fillText("QR Code for:",10,20),r.fillText(e.substring(0,20),10,40),r.fillText("(Use QR library)",10,180),elements.qrModal.style.display="flex"}function downloadQRImage(){if(!elements.qrCanvas){showToast("No QR code to download","error");return}try{let e=document.createElement("a");e.download=`codetwix-qr-${Date.now()}.png`,e.href=elements.qrCanvas.toDataURL(),e.click(),showToast("QR Code downloaded! \uD83D\uDCE5","success")}catch(t){showToast("Failed to download QR code","error")}}function initializeEventListeners(){elements.themeSelector?.addEventListener("change",e=>themeManager.setTheme(e.target.value)),elements.fontSelector?.addEventListener("change",e=>themeManager.setFont(e.target.value)),elements.inputText?.addEventListener("input",()=>{clearTimeout(state.debounceTimer),state.debounceTimer=setTimeout(()=>{performConversion(),updateAutoDetection()},300)}),document.querySelectorAll(".direction-btn").forEach(e=>{e.addEventListener("click",()=>{let t=e.dataset.direction,r="encrypt"===t?"decrypt":"encrypt";e.dataset.direction=r,e.querySelector("span").textContent="encrypt"===r?"\uD83D\uDD12 Encrypt":"\uD83D\uDD13 Decrypt",performConversion()})}),elements.showBruteForce?.addEventListener("click",generateBruteForce),elements.showMatrix?.addEventListener("click",generatePlayfairMatrix),elements.closeBruteForce?.addEventListener("click",()=>elements.bruteForcePanel.style.display="none"),elements.closeMatrix?.addEventListener("click",()=>elements.matrixPanel.style.display="none"),elements.copyBtn?.addEventListener("click",()=>copyToClipboard()),elements.shareBtn?.addEventListener("click",generateShareLink),elements.qrBtn?.addEventListener("click",generateQRCode),document.querySelectorAll("[data-format]").forEach(e=>{e.addEventListener("click",()=>downloadFile(e.dataset.format))}),elements.downloadBtn?.addEventListener("click",e=>{e.stopPropagation();let t=e.target.closest(".download-group");t&&t.classList.toggle("active")}),document.addEventListener("click",e=>{e.target.closest(".download-group")||document.querySelectorAll(".download-group").forEach(e=>{e.classList.remove("active")})}),elements.clearHistoryBtn?.addEventListener("click",historyManager.clear),elements.closeQrModal?.addEventListener("click",()=>elements.qrModal.style.display="none"),elements.closeShareModal?.addEventListener("click",()=>elements.shareModal.style.display="none"),elements.copyShareLink?.addEventListener("click",()=>copyToClipboard(elements.shareLink.value)),elements.downloadQr?.addEventListener("click",downloadQRImage),document.addEventListener("click",e=>{e.target.classList.contains("modal")&&(e.target.style.display="none")}),[elements.caesarShift,elements.vigenereKey,elements.affineA,elements.affineB,elements.playfairKey,elements.xorKey].forEach(e=>{e?.addEventListener("input",()=>{clearTimeout(state.debounceTimer),state.debounceTimer=setTimeout(performConversion,500)})})}function initializeApp(){let e=["inputText","outputText","customDropdown","dropdownTrigger","dropdownMenu"].filter(e=>!document.getElementById(e));if(e.length>0){console.error("Missing required elements:",e);return}themeManager.setTheme(state.currentTheme),themeManager.setFont(state.currentFont),initializeCustomDropdown(),toggleCipherControls(),historyManager.render(),initializeEventListeners();let t=new URLSearchParams(window.location.search),r=t.get("share");if(r)try{let n=JSON.parse(atob(r));elements.inputText.value=n.input,elements.conversionMode.value=n.mode;let o=elements.dropdownMenu.querySelector(`[data-value="${n.mode}"]`);o&&selectOption(o),performConversion()}catch(a){console.error("Invalid share link")}setTimeout(()=>{showToast("Welcome to Codetwix v2.0! \uD83D\uDE80","success")},1e3)}window.historyManager=historyManager,window.selectBruteForceResult=selectBruteForceResult,document.addEventListener("DOMContentLoaded",initializeApp);
